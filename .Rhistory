ky_precincts
map_data_29
map_data_29 %>% mutate(VTDST = paste0('00', Precinct))
map_data_29 %>% mutate(VTDST = paste0('00', Precinct)) %>% inner_join(ky_precincts)
map_data_29 %>% mutate(VTDST = paste0('00', Precinct)) %>% inner_join(ky_precincts) -> map_data_shp
leaflet() %>%
addTiles() %>%
addPolygons(data = map_data_shp,
weight = 2,
opacity = 1,
color = ~col,
fillOpacity = .7)
library(leaflet)
leaflet() %>%
addTiles() %>%
addPolygons(data = map_data_shp,
weight = 2,
opacity = 1,
color = ~col,
fillOpacity = .7)
map_data_shp
library(sf)
leaflet() %>%
addTiles() %>%
addPolygons(data = map_data_shp,
weight = 2,
opacity = 1,
color = ~col,
fillOpacity = .7)
ky_precincts <- readr::read_rds('/srv/data/shapefiles/precincts.rds')
map_data_29 %>% mutate(VTDST = paste0('00', Precinct)) %>% inner_join(ky_precincts) -> map_data_shp
leaflet() %>%
addTiles() %>%
addPolygons(data = map_data_shp,
weight = 2,
opacity = 1,
color = ~col,
fillOpacity = .7)
map_data_29 %>% mutate(VTDST = paste0('00', Precinct)) %>% inner_join(ky_precincts) -> map_data_shp
leaflet() %>%
addTiles() %>%
addPolygons(data = map_data_shp,
weight = 2,
opacity = 1,
color = ~col,
fillOpacity = .7)
map_data_shp
ky_precincts %>% inner_join(map_data_29 %>% mutate(VTDST = paste0('00', Precinct))) -> map_data_shp
leaflet() %>%
addTiles() %>%
addPolygons(data = map_data_shp,
weight = 2,
opacity = 1,
color = ~col,
fillOpacity = .7)
prec
tbl(db, 'election_data') %>%
filter(year == 2016, election == 'primary', str_detect(race, 'President')) %>%
select(Precinct,party, votes)
tbl(db, 'election_data') %>%
filter(year == 2016, election == 'primary')
golem::add_module('primary-22')
golem::add_module('primary_22')
library(tidyverse)
lou_mayor_dem <- read_rds('/srv/data/maps/mayor_leaf.rds')
# Set options here
options(golem.app.prod = FALSE) # TRUE = production mode, FALSE = development mode
# Detach all loaded packages and clean your environment
golem::detach_all_attached()
# rm(list=ls(all.names = TRUE))
# Document and reload your package
golem::document_and_reload()
# Run the application
run_app()
# Set options here
options(golem.app.prod = FALSE) # TRUE = production mode, FALSE = development mode
# Detach all loaded packages and clean your environment
golem::detach_all_attached()
# rm(list=ls(all.names = TRUE))
# Document and reload your package
golem::document_and_reload()
# Run the application
run_app()
# Set options here
options(golem.app.prod = FALSE) # TRUE = production mode, FALSE = development mode
# Detach all loaded packages and clean your environment
golem::detach_all_attached()
# rm(list=ls(all.names = TRUE))
# Document and reload your package
golem::document_and_reload()
# Run the application
run_app()
# Set options here
options(golem.app.prod = FALSE) # TRUE = production mode, FALSE = development mode
# Detach all loaded packages and clean your environment
golem::detach_all_attached()
# rm(list=ls(all.names = TRUE))
# Document and reload your package
golem::document_and_reload()
# Run the application
run_app()
# Set options here
options(golem.app.prod = FALSE) # TRUE = production mode, FALSE = development mode
# Detach all loaded packages and clean your environment
golem::detach_all_attached()
# rm(list=ls(all.names = TRUE))
# Document and reload your package
golem::document_and_reload()
# Run the application
run_app()
?icon
# Set options here
options(golem.app.prod = FALSE) # TRUE = production mode, FALSE = development mode
# Detach all loaded packages and clean your environment
golem::detach_all_attached()
# rm(list=ls(all.names = TRUE))
# Document and reload your package
golem::document_and_reload()
# Run the application
run_app()
library(tidyverse)
library(janitor)
library(pool)
db <- pool::dbPool(odbc::odbc(),
.connection_string = "Driver={PostgreSQL ANSI};",
Database = "kypolitics")
# candidates <- read_csv('/srv/data/candidates.csv')
# candidates_db <- candidates %>%
#   clean_names() %>%
#   filter(is.na(withdrawn), is.na(disqualified)) %>%
#   select(last_name, first_name, middle_name, suffix, party, office, district, division)
candidates <- read_csv('/srv/data/candidates_2022_tbl.csv')
dbWriteTable(db, 'candidates_22', candidates, overwrite = TRUE, temporary = F, indexes = c('office', 'party'))
library(tidyverse)
library(janitor)
library(pool)
db <- pool::dbPool(odbc::odbc(),
.connection_string = "Driver={PostgreSQL ANSI};",
Database = "kypolitics")
# candidates <- read_csv('/srv/data/candidates.csv')
# candidates_db <- candidates %>%
#   clean_names() %>%
#   filter(is.na(withdrawn), is.na(disqualified)) %>%
#   select(last_name, first_name, middle_name, suffix, party, office, district, division)
candidates <- read_csv('/srv/data/candidates_2022_tbl.csv')
dbWriteTable(db, 'candidates_22', candidates, overwrite = TRUE, temporary = F, indexes = c('office', 'party'))
candidates
candidates <- read_csv('/srv/data/candidates_2022_tbl.csv') %>%
bind_rows(tibble(first_name = 'Byron', middle_name = 'L.', last_name = 'Hobgood', office = 'State Representative', district = 4))
dbWriteTable(db, 'candidates_22', candidates, overwrite = TRUE, temporary = F, indexes = c('office', 'party'))
tbl(db, 'site_visit_history') %>%
collect() %>%
mutate(day = as.Date(time %m-% hours(5))) %>%
count(day) %>%
arrange(day) %>%
ggplot(aes(x = day, y = n, label = n)) +
geom_col() +
geom_label()
library(lubridate)
tbl(db, 'site_visit_history') %>%
collect() %>%
mutate(day = as.Date(time %m-% hours(5))) %>%
count(day) %>%
arrange(day) %>%
ggplot(aes(x = day, y = n, label = n)) +
geom_col() +
geom_label()
tbl(db, 'site_visit_history') %>%
collect()
tbl(db, 'site_visit_history') %>%
count(app)
tbl(db, 'site_visit_history') %>%
collect() %>% View()
collect() %>% View()
tbl(db, 'site_visit_history') %>% collect() %>% View()
tbl(db, 'site_visit_history') %>%
collect() %>%
mutate(day = as.Date(time %m-% hours(5))) %>%
count(day) %>%
arrange(day) %>%
ggplot(aes(x = day, y = n, label = n)) +
geom_col() +
geom_label()
ky_counties <- readr::read_rds('/srv/data/shapefiles/counties.rds')
ky_precincts <- readr::read_rds('/srv/data/shapefiles/precincts.rds')
house_plan <- readr::read_rds('/srv/data/shapefiles/gop_plan_22_shp_BILL_VERSION.rds')
house_plan_hcs <- readr::read_rds('/srv/data/shapefiles/gop_plan_22_shp_hcs.rds')
house_plan_dem <- readr::read_rds('/srv/data/shapefiles/dem_plan_22_shp.rds')
house_2014 <- readr::read_rds('/srv/data/shapefiles/house_map_2014.rds')
cong_plan <- readr::read_rds('/srv/data/shapefiles/gop_plan_cong_22.rds')
sen_plan <- readr::read_rds('/srv/data/shapefiles/gop_plan_sen_22.rds')
sen_2014 <- readr::read_rds('/srv/data/shapefiles/senate_map_2014.rds')
can_tbl <- tbl(db, 'candidates_22') %>%
filter(office == 'State Representative') %>%
distinct() %>%
collect() %>%
mutate(candidate = if_else(is.na(lrc_website), '#6baed6', '#08519c'),
district = as.character(district),
label = if_else(is.na(middle_name), str_glue('{district}-{first_name} {last_name}'), str_glue('{district}-{first_name} {middle_name} {last_name}')))
house_plan_hcs %>%
left_join(can_tbl) %>%
replace_na(list(candidate = 'white')) %>%
leaflet() %>%
addTiles() %>%
addPolygons(
weight = 2,
opacity = 1,
color = "black",
fillOpacity = 0,
label = ~label
) %>%
addPolygons(
fillOpacity = .7,
color = ~candidate,
weight = 1,
label = ~label
) %>%
addLegend(position = 'topright',
colors = c('#6baed6', '#08519c'),
labels = c('New Candidate', 'Incumbent'))
library(leaflet)
house_plan_hcs %>%
left_join(can_tbl) %>%
replace_na(list(candidate = 'white')) %>%
leaflet() %>%
addTiles() %>%
addPolygons(
weight = 2,
opacity = 1,
color = "black",
fillOpacity = 0,
label = ~label
) %>%
addPolygons(
fillOpacity = .7,
color = ~candidate,
weight = 1,
label = ~label
) %>%
addLegend(position = 'topright',
colors = c('#6baed6', '#08519c'),
labels = c('New Candidate', 'Incumbent'))
library(sf)
house_plan_hcs %>%
left_join(can_tbl) %>%
replace_na(list(candidate = 'white')) %>%
leaflet() %>%
addTiles() %>%
addPolygons(
weight = 2,
opacity = 1,
color = "black",
fillOpacity = 0,
label = ~label
) %>%
addPolygons(
fillOpacity = .7,
color = ~candidate,
weight = 1,
label = ~label
) %>%
addLegend(position = 'topright',
colors = c('#6baed6', '#08519c'),
labels = c('New Candidate', 'Incumbent'))
leaflet() %>%
addTiles() %>%
addPolygons(data = house_plan_hcs,
group = '2022 HCS',
weight = 2,
opacity = 1,
color = "black",
fillOpacity = 0,
label = ~district) %>%
addPolygons(data = house_plan,
group = '2022 Original Bill',
weight = 2,
opacity = 1,
color = "green",
fillOpacity = 0,
label = ~district) %>%
addPolygons(data = house_plan_dem,
group = '2022 Democratic Plan',
weight = 2,
opacity = 1,
color = "blue",
fillOpacity = 0,
label = ~district)%>%
addPolygons(data = house_2014,
group = '2014',
weight = 2,
opacity = 1,
color = "red",
fillOpacity = 0,
label = ~DISTRICT) %>%
addLayersControl(
overlayGroups = c('2022 HCS', '2022 Original Bill', '2022 Democratic Plan', '2014'),
options = layersControlOptions(collapsed = FALSE)
) %>%
hideGroup(c('2022 Original Bill', '2022 Democratic Plan', '2014'))
library(tidyverse)
library(pool)
db <- pool::dbPool(odbc::odbc(),
.connection_string = "Driver={PostgreSQL ANSI};",
Database = "kypolitics")
ky_precincts <- readr::read_rds('/srv/data/shapefiles/precincts.rds')
ky_precincts
library(sf)
ky_precincts
ky_precincts %>% filter(VTDST == '00G126')
ky_precincts %>% filter(VTDST == '00G126') %>% leaflet()
library(leaflet())
library(leaflet)
ky_precincts %>% filter(VTDST == '00G126') %>% leaflet()
ky_precincts %>% filter(VTDST == '00G126') %>% leaflet() %>% addTiles()
ky_precincts %>% filter(VTDST == '00G126') %>% leaflet() %>% addTiles() %>% addPolygons()
library(tidyverse)
library(pool)
library(lubridate)
db <- pool::dbPool(odbc::odbc(),
.connection_string = "Driver={PostgreSQL ANSI};",
Database = "kypolitics")
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv')
expend <- read_csv('/srv/data/gov_23_expend_07072022.csv')
View(contrib)
library(janitor)
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>% clean_names()
expend <- read_csv('/srv/data/gov_23_expend_07072022.csv') %>% clean_names()
glimpse(contrib)
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(across(election_date, receipt_date, as.Date()))
?across
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(across(election_date, receipt_date, ~as.Date))
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(across(list(election_date, receipt_date), ~as.Date))
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(across(c(election_date, receipt_date), as.Date))
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(across(c(election_date, receipt_date), mdy))
View(contrib)
read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names()
read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>% glimpse()
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(election_date = mdy(election_date),
receipt_date = as.Date(mdy_hms(receipt_date))))
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(election_date = mdy(election_date),
receipt_date = as.Date(mdy_hms(receipt_date)))
View(contrib)
View(expend)
glimpse(expend)
expend <- read_csv('/srv/data/gov_23_expend_07072022.csv') %>%
clean_names() %>%
mutate(across(c(election_date, disbursement_date), ~mdy_hms))
expend <- read_csv('/srv/data/gov_23_expend_07072022.csv') %>%
clean_names() %>%
mutate(across(c(election_date, disbursement_date), mdy_hms))
View(expend)
glimpse(contrib)
contrib <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_names() %>%
mutate(election_date = mdy(election_date),
receipt_date = as.Date(mdy_hms(receipt_date)),
candidate = paste(str_to_upper(recipient_last_name), str_to_upper(recipient_first_name), sep = '_'))
View(contrib)
glimpse(expend)
expend <- read_csv('/srv/data/gov_23_expend_07072022.csv') %>%
clean_names() %>%
mutate(across(c(election_date, disbursement_date), mdy_hms),
candidate = paste(str_to_upper(from_candidate_last_name), str_to_upper(from_candidate_first_name), sep = '_'))
glimpse(contrib)
dbWriteTable(db, 'fundraising_contrib', contrib, overwrite = TRUE, temporary = F,
indexes = c('election_date', 'candidate'))
dbWriteTable(db, 'fundraising_expend', expend, overwrite = TRUE, temporary = F,
indexes = c('election_date', 'candidate'))
library(tidyverse)
library(pool)
library(lubridate)
db <- pool::dbPool(odbc::odbc(),
.connection_string = "Driver={PostgreSQL ANSI};",
Database = "kypolitics")
tbl(db, 'site_visit_history') %>%
collect() %>%
mutate(day = as.Date(time %m-% hours(5))) %>%
count(day) %>%
arrange(day) %>%
ggplot(aes(x = day, y = n, label = n)) +
geom_col() +
geom_label()
tbl(db, 'site_visit_history') %>%
collect() %>%
mutate(day = as.Date(time %m-% hours(5))) %>%
count(day) %>%
arrange(day) %>%
filter(day > '2022-05-01') %>%
ggplot(aes(x = day, y = n, label = n)) +
geom_col() +
geom_label()
tbl(db, 'site_visit_history') %>%
collect() %>%
mutate(day = as.Date(time %m-% hours(5))) %>%
count(day) %>%
arrange(day) %>%
filter(day > '2022-05-01') %>%
ggplot(aes(x = day, y = n, label = n)) +
geom_col() +
geom_label()
tbl(db, 'fundraising_contrib')
contrib_22 <- read_csv('/srv/data/primary_22_contribu_07142022.csv')
contrib_22 <- read_csv('/srv/data/primary_22_contrib_07142022.csv')
clean_data <- function(df){
df %>%
clean_names() %>%
mutate(election_date = mdy(election_date),
receipt_date = as.Date(mdy_hms(receipt_date)),
candidate = paste(str_to_upper(recipient_last_name), str_to_upper(recipient_first_name), sep = '_'))
}
contrib_23 <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_data()
library(tidyverse)
library(pool)
library(lubridate)
library(janitor)
clean_data <- function(df){
df %>%
clean_names() %>%
mutate(election_date = mdy(election_date),
receipt_date = as.Date(mdy_hms(receipt_date)),
candidate = paste(str_to_upper(recipient_last_name), str_to_upper(recipient_first_name), sep = '_'))
}
contrib_23 <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_data()
contrib_22 <- read_csv('/srv/data/primary_22_contrib_07142022.csv') %>%
clean_data()
expend_22 <- read_csv('/srv/data/primary_22_expend_07142022.csv') %>%
clean_data()
clean_contrib <- function(df){
df %>%
clean_names() %>%
mutate(election_date = mdy(election_date),
receipt_date = as.Date(mdy_hms(receipt_date)),
candidate = paste(str_to_upper(recipient_last_name), str_to_upper(recipient_first_name), sep = '_'))
}
clean_expend <- function(df){
df %>%
clean_names() %>%
mutate(across(c(election_date, disbursement_date), mdy_hms),
candidate = paste(str_to_upper(from_candidate_last_name), str_to_upper(from_candidate_first_name), sep = '_'))
}
contrib_23 <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_contrib()
expend_23 <- read_csv('/srv/data/gov_23_expend_07072022.csv') %>%
clean_expend()
contrib_22 <- read_csv('/srv/data/primary_22_contrib_07142022.csv') %>%
clean_contrib()
expend_22 <- read_csv('/srv/data/primary_22_expend_07142022.csv') %>%
clean_expend()
expend_22
contrib <- bind_rows(contrib_23, contrib_22)
expend <- bind_rows(expend_23, expend_22)
View(contrib)
contrib %>% coun(office_sought)
contrib %>% count(office_sought)
dbWriteTable(db, 'fundraising_contrib', contrib, overwrite = TRUE, temporary = F,
indexes = c('election_date', 'candidate'))
dbWriteTable(db, 'fundraising_expend', expend, overwrite = TRUE, temporary = F,
indexes = c('election_date', 'candidate'))
library(tidyverse)
library(pool)
library(lubridate)
library(janitor)
db <- pool::dbPool(odbc::odbc(),
.connection_string = "Driver={PostgreSQL ANSI};",
Database = "kypolitics")
clean_contrib <- function(df){
df %>%
clean_names() %>%
mutate(election_date = mdy(election_date),
receipt_date = as.Date(mdy_hms(receipt_date)),
candidate = paste(str_to_upper(recipient_last_name), str_to_upper(recipient_first_name), sep = '_'))
}
clean_expend <- function(df){
df %>%
clean_names() %>%
mutate(across(c(election_date, disbursement_date), mdy_hms),
candidate = paste(str_to_upper(from_candidate_last_name), str_to_upper(from_candidate_first_name), sep = '_'))
}
contrib_23 <- read_csv('/srv/data/gov_23_contrib_07072022.csv') %>%
clean_contrib()
expend_23 <- read_csv('/srv/data/gov_23_expend_07072022.csv') %>%
clean_expend()
contrib_22 <- read_csv('/srv/data/primary_22_contrib_07142022.csv') %>%
clean_contrib()
expend_22 <- read_csv('/srv/data/primary_22_expend_07142022.csv') %>%
clean_expend()
contrib <- bind_rows(contrib_23, contrib_22)
expend <- bind_rows(expend_23, expend_22)
glimpse(expend)
expend %>% filter(recipient_first_name == 'Virginia', recipient_last_name == 'Woodward')
expend %>% filter(recipient_first_name == 'Virginia', recipient_last_name == 'Woodward') %>% View()
expend %>% filter(recipient_first_name == 'Virginia', recipient_last_name == 'Woodward') %>% group_by(candidate) %>% summarize(amt = sum(disbursement_amount))
expend %>% filter(recipient_first_name == 'Virginia', recipient_last_name == 'Woodward') %>% group_by(candidate) %>% summarize(amt = sum(disbursement_amount)) %>% arrange(desc(amt))
expend %>% filter(recipient_first_name == 'Beth', recipient_last_name == 'Thorpe') %>% group_by(candidate) %>% summarize(amt = sum(disbursement_amount)) %>% arrange(desc(amt))
